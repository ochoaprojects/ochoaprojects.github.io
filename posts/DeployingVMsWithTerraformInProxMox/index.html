<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Deploying VMs With Terraform In ProxMox" /><meta property="og:locale" content="en" /><meta name="description" content="Leveraging our ProxMox cloud-init templates to deploy VMs entirely through Terraform quickly and easily." /><meta property="og:description" content="Leveraging our ProxMox cloud-init templates to deploy VMs entirely through Terraform quickly and easily." /><link rel="canonical" href="https://ochoaprojects.github.io/posts/DeployingVMsWithTerraformInProxMox/" /><meta property="og:url" content="https://ochoaprojects.github.io/posts/DeployingVMsWithTerraformInProxMox/" /><meta property="og:site_name" content="OchoaProjects" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-05T10:00:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Deploying VMs With Terraform In ProxMox" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-19T02:58:56-07:00","datePublished":"2022-06-05T10:00:00-07:00","description":"Leveraging our ProxMox cloud-init templates to deploy VMs entirely through Terraform quickly and easily.","headline":"Deploying VMs With Terraform In ProxMox","mainEntityOfPage":{"@type":"WebPage","@id":"https://ochoaprojects.github.io/posts/DeployingVMsWithTerraformInProxMox/"},"url":"https://ochoaprojects.github.io/posts/DeployingVMsWithTerraformInProxMox/"}</script><title>Deploying VMs With Terraform In ProxMox | OchoaProjects</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="OchoaProjects"><meta name="application-name" content="OchoaProjects"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/project-assets/Brandon-Ochoa-Github.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">OchoaProjects</a></div><div class="site-subtitle font-italic">A place where I post my projects and things that I am learning or working on.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/ochoaprojects" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/brandon-ochoa/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.youtube.com/@ochoaprojects9930" aria-label="youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['brandon','ochoaprojects.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Deploying VMs With Terraform In ProxMox</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Deploying VMs With Terraform In ProxMox</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1654448400" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 5, 2022 </em> </span> <span> Updated <em class="" data-ts="1655632736" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 19, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/ochoaprojects">Brandon Ochoa</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3397 words"> <em>18 min</em> read</span></div></div></div><div class="post-content"><p>Leveraging our ProxMox cloud-init templates to deploy VMs entirely through Terraform quickly and easily.</p><h2 id="table-of-contents"><span class="mr-2">Table of Contents</span><a href="#table-of-contents" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="#prep-a-cloud-init-template-to-use-with-terraform">Prep a cloud-init template to use with Terraform</a><ul><li><a href="#install-qemu-guest-agent-on-cloud-init-template">Install qemu-guest-agent on cloud-init template</a></ul><li><a href="#install-terraform">Install Terraform</a><li><a href="#creating-authentication-for-terraform-to-make-changes-to-proxmox-via-api-keys">Creating authentication for Terraform to make changes to ProxMox via API keys</a><li><a href="#terraform-basic-initialization-and-provider-installation">Terraform basic initialization and provider installation</a><li><a href="#develop-terraform-plan">Develop Terraform plan</a><ul><li><a href="#maintf">main.tf</a><li><a href="#varstf">vars.tf</a></ul><li><a href="#terraform-plan">Terraform plan</a><li><a href="#run-terraform-plan-and-watch-the-vms-appear">Run Terraform plan and watch the VMs appear!</a><li><a href="#terraform-destroy">Terraform Destroy</a></ul><h1 id="prep-a-cloud-init-template-to-use-with-terraform">Prep a cloud-init template to use with Terraform</h1><p>So I will very briefly recap the commands from a previous post that will get you a working cloud init template for ProxMox so that we can use it with Terraform to automate deploying VMs. Please check the previous post if you want more details.</p><ol><li>Download Debian Cloud Image<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wget https://cloud.debian.org/images/cloud/bullseye/20220613-1045/debian-11-genericcloud-amd64-20220613-1045.qcow2
</pre></table></code></div></div><li>Create VM and Convert to Template<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>qm create 9500 <span class="nt">--name</span> Debian11CloudInit <span class="nt">--net0</span> virtio,bridge<span class="o">=</span>vmbr0
qm importdisk 9500 debian-11-genericcloud-amd64-20220613-1045.qcow2 local-lvm
qm <span class="nb">set </span>9500 <span class="nt">--scsihw</span> virtio-scsi-pci <span class="nt">--scsi0</span> local-lvm:vm-9500-disk-0
qm <span class="nb">set </span>9500 <span class="nt">--ide2</span> local-lvm:cloudinit
qm <span class="nb">set </span>9500 <span class="nt">--boot</span> c <span class="nt">--bootdisk</span> scsi0
qm <span class="nb">set </span>9500 <span class="nt">--serial0</span> socket <span class="nt">--vga</span> serial0
qm <span class="nb">set </span>9500 <span class="nt">--agent</span> <span class="nv">enabled</span><span class="o">=</span>1
qm template 9500
</pre></table></code></div></div></ol><h2 id="install-qemu-guest-agent-on-cloud-init-template"><span class="mr-2">Install qemu-guest-agent on cloud-init template</span><a href="#install-qemu-guest-agent-on-cloud-init-template" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now there is an issue if you simply leave the cloud-init template with just the commands above. If you call on terraform apply to deploy the VMs using the image without the <code class="language-plaintext highlighter-rouge">qemu-guest-agent</code> installed it will forever be stuck “<code class="language-plaintext highlighter-rouge">still creating...</code>” as show in the image below.</p><p><img data-src="/project-assets/DeployingVMsWithTerraform/terraform-stuck-still-creating.png" alt="Terraform Stuck Still Creating" data-proofer-ignore></p><p>To resolve this we first need to clone the template we created previously as a VM we can boot and log into to install our qemu-guest-agent</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>qm clone 9500 9000 <span class="nt">--name</span> KubernetesNodeTemplate
</pre></table></code></div></div><p>Start the VM</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>qm start 9000
</pre></table></code></div></div><p>Log into the VM. I’ll be using an ssh key that I configured with my cloud-init for this template over the network, but you can also simply use the console from the ProxMox Web UI if you set up a password for the default user.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ssh <span class="nt">-i</span> cloud-init brandon@192.168.2.191
</pre></table></code></div></div><p>Make sure everything is up to date, install the qemu-guest-agent, then shutdown the VM.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>qemu-guest-agent
<span class="nb">sudo </span>shutdown now
</pre></table></code></div></div><p>With these steps out of the way, we are ready to convert our VM to a template to be used by terraform.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>qm template 9000
</pre></table></code></div></div><h1 id="install-terraform">Install Terraform</h1><p>Now we need to install terraform to our control system if it is not already there.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -
sudo apt-add-repository "deb [arch=$(dpkg --print-architecture)] https://apt.releases.hashicorp.com $(lsb_release -cs) main"
sudo apt update
sudo apt install terraform
</pre></table></code></div></div><h1 id="creating-authentication-for-terraform-to-make-changes-to-proxmox-via-api-keys">Creating authentication for Terraform to make changes to ProxMox via API keys</h1><p>There are probably better settings for this section to more securely lock down this user but this will at least get you started with using terraform on ProxMox.</p><p>So we need to create a new user. We’ll name it ‘terraform’. To add a new user go to Datacenter in the left tab, then Permissions -&gt; Users -&gt; Click add, name the user and click add.</p><p><img data-src="/project-assets/DeployingVMsWithTerraform/add-user-in-proxmox.png" alt="Add User In ProxMox" data-proofer-ignore></p><p>Next, we need to add API tokens. Click API tokens below users in the permissions category and click add. Select the user you just created and give the token an ID, and uncheck privilege separation (which means we want the token to have the same permissions as the user):</p><p><img data-src="/project-assets/DeployingVMsWithTerraform/add-api-token-in-proxmox.png" alt="Add API Token In ProxMox" data-proofer-ignore></p><p>When you click Add it will show you the key. Save this key. It will never be displayed again!</p><p><img data-src="/project-assets/DeployingVMsWithTerraform/api-token-secret.png" alt="API Token Secret" data-proofer-ignore></p><p>Next we need to add a role to the new user. Permissions -&gt; Add -&gt; Path = ‘/’, User is the one you just made, role = ‘PVEVMAdmin’. This gives the user (and associated API token!) rights to all nodes (the / for path) to do VMAdmin activities:</p><p><img data-src="/project-assets/DeployingVMsWithTerraform/add-user-permissions-pvevmadmin.png" alt="Alt text" data-proofer-ignore></p><p>You also need to add permissions to the storage used by the VMs you want to deploy (both from and to), for me this is /storage/local-lvm. Use Admin for the role here because the user also needs the ability to allocate space in the datastore (you could use PVEVMAdmin + a datastore role):</p><p><img data-src="/project-assets/DeployingVMsWithTerraform/add-user-permissions-administrator.png" alt="Alt text" data-proofer-ignore></p><p>We are now done with the permissions. It is time for Terraform!</p><h1 id="terraform-basic-initialization-and-provider-installation">Terraform basic initialization and provider installation</h1><p>Terraform has three main stages: init, plan, and apply. We will start with describing the plans, which can be thought of a a type of configuration file for what you want to do. Plans are files stored in directories. Make a new directory (terraform), and create two files: main.tf and vars.tf:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">cd</span> ~
<span class="nb">mkdir </span>terraform <span class="o">&amp;&amp;</span> <span class="nb">cd </span>terraform
<span class="nb">touch </span>main.tf vars.tf
</pre></table></code></div></div><p>The two files are hopefully reasonably named. The main content will be in main.tf and we will put a few variables in vars.tf. Everything could go in main.tf but it is a good practice to start splitting things out early. I actually don’t have as much in vars.tf as I should but we all gotta start somewhere</p><p>Ok so in main.tf let’s add the bare minimum. We need to tell Terraform to use a provider, which is the term they use for the connector to the entity Terraform will be interacting with. Since we are using Proxmox, we need to use a Proxmox provider. This is actually super easy – we just need to specify the name and version and Terraform goes out and grabs it from github and installs it. I used the Telmate Proxmox provider.</p><p>main.tf:</p><div class="language-terraform highlighter-rouge"><div class="code-header"> <span data-label-text="Terraform"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">proxmox</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"telmate/proxmox"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"2.7.4"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Save the file. Now we’ll initialize Terraform with our barebones plan (terraform init), which will force it to go out and grab the provider. If all goes well, we will be informed that the provider was installed and that Terraform has been initialized. Terraform is also really nice in that it tells you the next step towards the bottom of the output (“try running ‘terraform plan’ next”).</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre>brandon@ProxMox:~/terraform# terraform init

Initializing the backend...

Initializing provider plugins...
- Finding telmate/proxmox versions matching "2.7.4"...
- Installing telmate/proxmox v2.7.4...
- Installed telmate/proxmox v2.7.4 (self-signed, key ID A9EBBE091B35AFCE)

Partner and community providers are signed by their developers.
If you'd like to know more about provider signing, you can read about it here:
https://www.terraform.io/docs/cli/plugins/signing.html

Terraform has created a lock file .terraform.lock.hcl to record the provider
selections it made above. Include this file in your version control repository
so that Terraform can guarantee to make the same selections by default when
you run "terraform init" in the future.

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.
</pre></table></code></div></div><h1 id="develop-terraform-plan">Develop Terraform plan</h1><p>Alright with the provider installed, it is time to use it to deploy a VM. Alter your main.tf file to be the following. I break it down inside the file with comments</p><h3 id="maintf"><span class="mr-2">main.tf</span><a href="#maintf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-terraform highlighter-rouge"><div class="code-header"> <span data-label-text="Terraform"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre><td class="rouge-code"><pre><span class="c1">#Configure ProxMox provider using Telmate found here https://github.com/Telmate/terraform-provider-proxmox</span>
<span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">proxmox</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"telmate/proxmox"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"2.7.4"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1">#Configure ProxMox API user/permissions and API url</span>
<span class="k">provider</span> <span class="s2">"proxmox"</span> <span class="p">{</span>
  <span class="nx">pm_api_url</span> <span class="p">=</span> <span class="s2">"https://proxmox:8006/api2/json"</span>

  <span class="nx">pm_api_token_id</span> <span class="p">=</span> <span class="s2">"terraform@pam!terraform_token"</span>

  <span class="nx">pm_api_token_secret</span> <span class="p">=</span> <span class="s2">"&lt;your_api_token_secret&gt;"</span>

  <span class="nx">pm_tls_insecure</span> <span class="p">=</span> <span class="kc">true</span>
<span class="p">}</span>
<span class="c1">#Configure Proxmox Resources Here</span>
<span class="k">resource</span> <span class="s2">"proxmox_vm_qemu"</span> <span class="s2">"Kubernetes-Node"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="p">=</span> <span class="mi">1</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"Kubernetes-Node-</span><span class="k">${</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="k">}</span><span class="s2">"</span>

  <span class="nx">target_node</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">proxmox_host</span>

  <span class="nx">clone</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">template_name</span>
  <span class="c1">#Basic VM settings here</span>
  <span class="nx">agent</span> <span class="p">=</span> <span class="mi">1</span> <span class="c1"># QEMU Guest Agent, 1 means installing the guest agent on this VM is set to True</span>
  <span class="nx">os_type</span> <span class="p">=</span> <span class="s2">"cloud-init"</span>
  <span class="nx">cores</span> <span class="p">=</span> <span class="mi">2</span>
  <span class="nx">sockets</span> <span class="p">=</span> <span class="mi">1</span>
  <span class="nx">cpu</span> <span class="p">=</span> <span class="s2">"host"</span>
  <span class="nx">memory</span> <span class="p">=</span> <span class="mi">2048</span>
  <span class="nx">scsihw</span> <span class="p">=</span> <span class="s2">"virtio-scsi-pci"</span>
  <span class="nx">bootdisk</span> <span class="p">=</span> <span class="s2">"scsi0"</span>

  <span class="nx">disk</span> <span class="p">{</span>
    <span class="nx">slot</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="c1"># set disk size here. leave it small for testing because expanding the disk takes time.</span>
    <span class="nx">size</span> <span class="p">=</span> <span class="s2">"10G"</span>
    <span class="nx">type</span> <span class="p">=</span> <span class="s2">"scsi"</span>
    <span class="nx">storage</span> <span class="p">=</span> <span class="s2">"local-lvm"</span>
    <span class="nx">iothread</span> <span class="p">=</span> <span class="mi">1</span>
  <span class="p">}</span>
  
  <span class="c1"># if you want two NICs, just copy this whole network section and duplicate it</span>
  <span class="nx">network</span> <span class="p">{</span>
    <span class="nx">model</span> <span class="p">=</span> <span class="s2">"virtio"</span>
    <span class="nx">bridge</span> <span class="p">=</span> <span class="s2">"vmbr0"</span>
  <span class="p">}</span>
  <span class="nx">lifecycle</span> <span class="p">{</span>
    <span class="nx">ignore_changes</span> <span class="p">=</span> <span class="p">[</span>
      <span class="nx">network</span><span class="p">,</span>
    <span class="p">]</span>
  <span class="p">}</span>
  
  <span class="c1"># sshkeys set using variables. the variable contains the text of the key.</span>
  <span class="nx">sshkeys</span> <span class="p">=</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
  ${var.ssh_key}
</span><span class="no">  EOF
</span><span class="p">}</span>
</pre></table></code></div></div><p>Now for the vars.tf file. This is a bit easier to understand. Just declare a variable, give it a name, and a default value.</p><h3 id="varstf"><span class="mr-2">vars.tf</span><a href="#varstf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-terraform highlighter-rouge"><div class="code-header"> <span data-label-text="Terraform"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">variable</span> <span class="s2">"ssh_key"</span> <span class="p">{</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="s2">"ssh-rsa &lt;your_public_key_here&gt; brandon@ProxMox"</span>
<span class="p">}</span>

<span class="k">variable</span> <span class="s2">"proxmox_host"</span> <span class="p">{</span>
    <span class="nx">default</span> <span class="p">=</span> <span class="s2">"ProxMox"</span>
<span class="p">}</span>

<span class="k">variable</span> <span class="s2">"template_name"</span> <span class="p">{</span>
    <span class="nx">default</span> <span class="p">=</span> <span class="s2">"KubernetesNodeTemplate"</span>
<span class="p">}</span>
</pre></table></code></div></div><h1 id="terraform-plan">Terraform plan</h1><p>Now with the .tf files completed, we can run the plan (terraform plan). We defined a count=1 resource, so we would expect Terraform to create a single VM. Let’s have Terraform run through the plan and tell us what it intends to do. It tells us a lot.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
</pre><td class="rouge-code"><pre>brandon@ProxMox:~/terraform# terraform plan

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # proxmox_vm_qemu.Kubernetes-Node[0] will be created
  + resource "proxmox_vm_qemu" "Kubernetes-Node" {
      + additional_wait           = 15
      + agent                     = 1
      + balloon                   = 0
      + bios                      = "seabios"
      + boot                      = "cdn"
      + bootdisk                  = "scsi0"
      + clone                     = "KubernetesNodeTemplate"
      + clone_wait                = 15
      + cores                     = 2
      + cpu                       = "host"
      + default_ipv4_address      = (known after apply)
      + define_connection_info    = true
      + force_create              = false
      + full_clone                = true
      + guest_agent_ready_timeout = 600
      + hotplug                   = "network,disk,usb"
      + id                        = (known after apply)
      + kvm                       = true
      + memory                    = 2048
      + name                      = "Kubernetes-Node-1"
      + nameserver                = (known after apply)
      + numa                      = false
      + onboot                    = true
      + os_type                   = "cloud-init"
      + preprovision              = true
      + reboot_required           = (known after apply)
      + scsihw                    = "virtio-scsi-pci"
      + searchdomain              = (known after apply)
      + sockets                   = 1
      + ssh_host                  = (known after apply)
      + ssh_port                  = (known after apply)
      + sshkeys                   = &lt;&lt;-EOT
              ssh-rsa &lt;your_public_key_here&gt; brandon@ProxMox
        EOT
      + target_node               = "ProxMox"
      + unused_disk               = (known after apply)
      + vcpus                     = 0
      + vlan                      = -1
      + vmid                      = (known after apply)

      + disk {
          + backup       = 0
          + cache        = "none"
          + file         = (known after apply)
          + format       = (known after apply)
          + iothread     = 1
          + mbps         = 0
          + mbps_rd      = 0
          + mbps_rd_max  = 0
          + mbps_wr      = 0
          + mbps_wr_max  = 0
          + media        = (known after apply)
          + replicate    = 0
          + size         = "10G"
          + slot         = 0
          + ssd          = 0
          + storage      = "local-lvm"
          + storage_type = (known after apply)
          + type         = "scsi"
          + volume       = (known after apply)
        }

      + network {
          + bridge    = "vmbr0"
          + firewall  = false
          + link_down = false
          + macaddr   = (known after apply)
          + model     = "virtio"
          + queues    = (known after apply)
          + rate      = (known after apply)
          + tag       = -1
        }
    }

Plan: 1 to add, 0 to change, 0 to destroy.

───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────

Note: You didn't use the -out option to save this plan, so Terraform can't guarantee to take exactly these actions if you run "terraform
apply" now.
</pre></table></code></div></div><p>You can see the output of the planning phase of Terraform. It is telling us it will create proxmox_vm_qemu.Kubernetes-Node[0] with a list of parameters. You can double-check the IP address here, as well as the rest of the basic settings. At the bottom is the summary – “Plan: 1 to add, 0 to change, 0 to destroy.” Also note that it tells us again what step to run next – “terraform apply”.</p><h1 id="run-terraform-plan-and-watch-the-vms-appear">Run Terraform plan and watch the VMs appear</h1><p>With the summary stating what we want, we can now apply the plan (terraform apply). Note that it prompts you to type in ‘yes’ to apply the changes after it determines what the changes are. It typically takes 1m15s +/- 15s for my VMs to get created.</p><p>If all goes well, you will be informed that 1 resource was added!</p><p><img data-src="/project-assets/DeployingVMsWithTerraform/terraform-apply-complete.png" alt="Terraform Apply Complete" data-proofer-ignore></p><p>Command and full output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
</pre><td class="rouge-code"><pre>brandon@ProxMox:~/terraform# terraform apply

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # proxmox_vm_qemu.Kubernetes-Node[0] will be created
  + resource "proxmox_vm_qemu" "Kubernetes-Node" {
      + additional_wait           = 15
      + agent                     = 1
      + balloon                   = 0
      + bios                      = "seabios"
      + boot                      = "cdn"
      + bootdisk                  = "scsi0"
      + clone                     = "KubernetesNodeTemplate"
      + clone_wait                = 15
      + cores                     = 2
      + cpu                       = "host"
      + default_ipv4_address      = (known after apply)
      + define_connection_info    = true
      + force_create              = false
      + full_clone                = true
      + guest_agent_ready_timeout = 600
      + hotplug                   = "network,disk,usb"
      + id                        = (known after apply)
      + kvm                       = true
      + memory                    = 2048
      + name                      = "Kubernetes-Node-1"
      + nameserver                = (known after apply)
      + numa                      = false
      + onboot                    = true
      + os_type                   = "cloud-init"
      + preprovision              = true
      + reboot_required           = (known after apply)
      + scsihw                    = "virtio-scsi-pci"
      + searchdomain              = (known after apply)
      + sockets                   = 1
      + ssh_host                  = (known after apply)
      + ssh_port                  = (known after apply)
      + sshkeys                   = &lt;&lt;-EOT
              ssh-rsa &lt;your_public_key_here&gt; brandon@ProxMox
        EOT
      + target_node               = "ProxMox"
      + unused_disk               = (known after apply)
      + vcpus                     = 0
      + vlan                      = -1
      + vmid                      = (known after apply)

      + disk {
          + backup       = 0
          + cache        = "none"
          + file         = (known after apply)
          + format       = (known after apply)
          + iothread     = 1
          + mbps         = 0
          + mbps_rd      = 0
          + mbps_rd_max  = 0
          + mbps_wr      = 0
          + mbps_wr_max  = 0
          + media        = (known after apply)
          + replicate    = 0
          + size         = "10G"
          + slot         = 0
          + ssd          = 0
          + storage      = "local-lvm"
          + storage_type = (known after apply)
          + type         = "scsi"
          + volume       = (known after apply)
        }

      + network {
          + bridge    = "vmbr0"
          + firewall  = false
          + link_down = false
          + macaddr   = (known after apply)
          + model     = "virtio"
          + queues    = (known after apply)
          + rate      = (known after apply)
          + tag       = -1
        }
    }

Plan: 1 to add, 0 to change, 0 to destroy.

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

proxmox_vm_qemu.Kubernetes-Node[0]: Creating...
proxmox_vm_qemu.Kubernetes-Node[0]: Still creating... [10s elapsed]
proxmox_vm_qemu.Kubernetes-Node[0]: Still creating... [20s elapsed]
proxmox_vm_qemu.Kubernetes-Node[0]: Still creating... [30s elapsed]
proxmox_vm_qemu.Kubernetes-Node[0]: Still creating... [40s elapsed]
proxmox_vm_qemu.Kubernetes-Node[0]: Still creating... [50s elapsed]
proxmox_vm_qemu.Kubernetes-Node[0]: Still creating... [1m0s elapsed]
proxmox_vm_qemu.Kubernetes-Node[0]: Still creating... [1m10s elapsed]
proxmox_vm_qemu.Kubernetes-Node[0]: Still creating... [1m20s elapsed]
proxmox_vm_qemu.Kubernetes-Node[0]: Still creating... [1m30s elapsed]
proxmox_vm_qemu.Kubernetes-Node[0]: Still creating... [1m40s elapsed]
proxmox_vm_qemu.Kubernetes-Node[0]: Still creating... [1m50s elapsed]
proxmox_vm_qemu.Kubernetes-Node[0]: Creation complete after 1m54s [id=ProxMox/qemu/100]

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.
</pre></table></code></div></div><p>Now go check Proxmox and see if your VM was created: <img data-src="/project-assets/DeployingVMsWithTerraform/terraform-vms-live.png" alt="Terraform VMs Live" data-proofer-ignore></p><p>Success! You should now be able to SSH into the new VM with the key you already provided.</p><h1 id="terraform-destroy">Terraform Destroy</h1><p>To remove a VM or anything created by Terraform with the .tf files we just used, we simply do the reverse of that by using the <code class="language-plaintext highlighter-rouge">terraform destroy</code> command.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
</pre><td class="rouge-code"><pre>brandon@ProxMox:~/terraform# terraform destroy
proxmox_vm_qemu.Kubernetes-Node[0]: Refreshing state... [id=ProxMox/qemu/100]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  - destroy

Terraform will perform the following actions:

  # proxmox_vm_qemu.Kubernetes-Node[0] will be destroyed
  - resource "proxmox_vm_qemu" "Kubernetes-Node" {
      - additional_wait           = 15 -&gt; null
      - agent                     = 1 -&gt; null
      - balloon                   = 0 -&gt; null
      - bios                      = "seabios" -&gt; null
      - boot                      = "cdn" -&gt; null
      - bootdisk                  = "scsi0" -&gt; null
      - ciuser                    = "brandon" -&gt; null
      - clone                     = "KubernetesNodeTemplate" -&gt; null
      - clone_wait                = 15 -&gt; null
      - cores                     = 2 -&gt; null
      - cpu                       = "host" -&gt; null
      - default_ipv4_address      = "192.168.2.191" -&gt; null
      - define_connection_info    = true -&gt; null
      - disk_gb                   = 0 -&gt; null
      - force_create              = false -&gt; null
      - full_clone                = true -&gt; null
      - guest_agent_ready_timeout = 600 -&gt; null
      - hotplug                   = "network,disk,usb" -&gt; null
      - id                        = "ProxMox/qemu/100" -&gt; null
      - kvm                       = true -&gt; null
      - memory                    = 2048 -&gt; null
      - name                      = "Kubernetes-Node-1" -&gt; null
      - numa                      = false -&gt; null
      - onboot                    = true -&gt; null
      - os_type                   = "cloud-init" -&gt; null
      - preprovision              = true -&gt; null
      - qemu_os                   = "other" -&gt; null
      - reboot_required           = false -&gt; null
      - scsihw                    = "virtio-scsi-pci" -&gt; null
      - sockets                   = 1 -&gt; null
      - ssh_host                  = "192.168.2.191" -&gt; null
      - ssh_port                  = "22" -&gt; null
      - sshkeys                   = &lt;&lt;-EOT
              ssh-rsa &lt;your_public_key_here&gt; brandon@ProxMox
            
        EOT -&gt; null
      - target_node               = "ProxMox" -&gt; null
      - unused_disk               = [] -&gt; null
      - vcpus                     = 0 -&gt; null
      - vlan                      = -1 -&gt; null

      - disk {
          - backup       = 0 -&gt; null
          - cache        = "none" -&gt; null
          - file         = "vm-100-disk-0" -&gt; null
          - format       = "raw" -&gt; null
          - iothread     = 1 -&gt; null
          - mbps         = 0 -&gt; null
          - mbps_rd      = 0 -&gt; null
          - mbps_rd_max  = 0 -&gt; null
          - mbps_wr      = 0 -&gt; null
          - mbps_wr_max  = 0 -&gt; null
          - replicate    = 0 -&gt; null
          - size         = "10G" -&gt; null
          - slot         = 0 -&gt; null
          - ssd          = 0 -&gt; null
          - storage      = "local-lvm" -&gt; null
          - storage_type = "lvmthin" -&gt; null
          - type         = "scsi" -&gt; null
          - volume       = "local-lvm:vm-100-disk-0" -&gt; null
        }

      - network {
          - bridge    = "vmbr0" -&gt; null
          - firewall  = false -&gt; null
          - link_down = false -&gt; null
          - macaddr   = "4E:54:B4:E7:91:17" -&gt; null
          - model     = "virtio" -&gt; null
          - queues    = 0 -&gt; null
          - rate      = 0 -&gt; null
          - tag       = -1 -&gt; null
        }
    }

Plan: 0 to add, 0 to change, 1 to destroy.

Do you really want to destroy all resources?
  Terraform will destroy all your managed infrastructure, as shown above.
  There is no undo. Only 'yes' will be accepted to confirm.

  Enter a value: yes

proxmox_vm_qemu.Kubernetes-Node[0]: Destroying... [id=ProxMoxK8S/qemu/100]
proxmox_vm_qemu.Kubernetes-Node[0]: Destruction complete after 4s

Destroy complete! Resources: 1 destroyed.
</pre></table></code></div></div><p><img data-src="/project-assets/DeployingVMsWithTerraform/terraform-destroy-complete.png" alt="Terraform Destroy Complete" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/infrastructure-as-code/'>Infrastructure as Code</a>, <a href='/categories/terraform/'>Terraform</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/terraform/" class="post-tag no-text-decoration" >terraform</a> <a href="/tags/proxmox/" class="post-tag no-text-decoration" >proxmox</a> <a href="/tags/cloudinit/" class="post-tag no-text-decoration" >cloudinit</a> <a href="/tags/automation/" class="post-tag no-text-decoration" >automation</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Deploying+VMs+With+Terraform+In+ProxMox+-+OchoaProjects&url=https%3A%2F%2Fochoaprojects.github.io%2Fposts%2FDeployingVMsWithTerraformInProxMox%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Deploying+VMs+With+Terraform+In+ProxMox+-+OchoaProjects&u=https%3A%2F%2Fochoaprojects.github.io%2Fposts%2FDeployingVMsWithTerraformInProxMox%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fochoaprojects.github.io%2Fposts%2FDeployingVMsWithTerraformInProxMox%2F&text=Deploying+VMs+With+Terraform+In+ProxMox+-+OchoaProjects" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/ProxMoxSetupInstall/">ProxMox Setup and Installation</a><li><a href="/posts/AboutMeAndTopology/">About Me and Homelab Topology</a><li><a href="/posts/PlexAutomation/">Plex Automation</a><li><a href="/posts/ProxMoxCloudInitImage/">Create a Debian Cloud-Init Template on Proxmox</a><li><a href="/posts/ProvisionDockerWithAnsible/">Provision a Linux Server With Docker Using Ansible</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/proxmox/">proxmox</a> <a class="post-tag" href="/tags/terraform/">terraform</a> <a class="post-tag" href="/tags/cloudinit/">cloudinit</a> <a class="post-tag" href="/tags/containers/">containers</a> <a class="post-tag" href="/tags/ec2/">ec2</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ProxMoxCloudInitImage/"><div class="card-body"> <em class="small" data-ts="1654275600" data-df="ll" > Jun 3, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Create a Debian Cloud-Init Template on Proxmox</h3><div class="text-muted small"><p> Cloud-Init is the de facto multi-distribution package that handles early initialization of a virtual machine instance. When the VM starts for the first time, the Cloud-Init software inside the VM w...</p></div></div></a></div><div class="card"> <a href="/posts/TerraformWithAWS/"><div class="card-body"> <em class="small" data-ts="1656435600" data-df="ll" > Jun 28, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Automating AWS VPC and EC2 Instances using Terraform</h3><div class="text-muted small"><p> Terraform is a powerful tool that allows us to automate infrastructure in our cloud providers and much more. Using terraform to automate the building and configuration of our AWS enviornment to be ...</p></div></div></a></div><div class="card"> <a href="/posts/UsingAWSLambdaWithAPIGateway/"><div class="card-body"> <em class="small" data-ts="1658768400" data-df="ll" > Jul 25, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Using AWS Lambda and API Gateway to Check URLs</h3><div class="text-muted small"><p> Using AWS Lambda Python functions and an API Gateway to deploy a URL Checker that looks for known malicious websites all while being serveless through Amazon Web Services. Table of Contents Ov...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/ProxMoxCloudInitImage/" class="btn btn-outline-primary" prompt="Older"><p>Create a Debian Cloud-Init Template on Proxmox</p></a> <a href="/posts/PortainerDocumented/" class="btn btn-outline-primary" prompt="Newer"><p>Portainer Documented</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/ochoaprojects">Brandon Ochoa</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> hosted on Github</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/proxmox/">proxmox</a> <a class="post-tag" href="/tags/terraform/">terraform</a> <a class="post-tag" href="/tags/cloudinit/">cloudinit</a> <a class="post-tag" href="/tags/containers/">containers</a> <a class="post-tag" href="/tags/ec2/">ec2</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
