<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Create a Debian Cloud-Init Template on Proxmox" /><meta property="og:locale" content="en" /><meta name="description" content="Cloud-Init is the de facto multi-distribution package that handles early initialization of a virtual machine instance. When the VM starts for the first time, the Cloud-Init software inside the VM will apply those settings." /><meta property="og:description" content="Cloud-Init is the de facto multi-distribution package that handles early initialization of a virtual machine instance. When the VM starts for the first time, the Cloud-Init software inside the VM will apply those settings." /><link rel="canonical" href="https://ochoaprojects.github.io/posts/ProxMoxCloudInitImage/" /><meta property="og:url" content="https://ochoaprojects.github.io/posts/ProxMoxCloudInitImage/" /><meta property="og:site_name" content="OchoaProjects" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-03T10:00:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Create a Debian Cloud-Init Template on Proxmox" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-02-28T17:03:25-08:00","datePublished":"2022-06-03T10:00:00-07:00","description":"Cloud-Init is the de facto multi-distribution package that handles early initialization of a virtual machine instance. When the VM starts for the first time, the Cloud-Init software inside the VM will apply those settings.","headline":"Create a Debian Cloud-Init Template on Proxmox","mainEntityOfPage":{"@type":"WebPage","@id":"https://ochoaprojects.github.io/posts/ProxMoxCloudInitImage/"},"url":"https://ochoaprojects.github.io/posts/ProxMoxCloudInitImage/"}</script><title>Create a Debian Cloud-Init Template on Proxmox | OchoaProjects</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="OchoaProjects"><meta name="application-name" content="OchoaProjects"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/project-assets/Brandon-Ochoa-Github.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">OchoaProjects</a></div><div class="site-subtitle font-italic">A place where I post my projects and things that I am learning or working on.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/ochoaprojects" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/brandon-ochoa/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.youtube.com/@ochoaprojects9930" aria-label="youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['brandon','ochoaprojects.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Create a Debian Cloud-Init Template on Proxmox</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Create a Debian Cloud-Init Template on Proxmox</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1654275600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 3, 2022 </em> </span> <span> Updated <em class="" data-ts="1677632605" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Feb 28, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/ochoaprojects">Brandon Ochoa</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1134 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><p>Cloud-Init is the de facto multi-distribution package that handles early initialization of a virtual machine instance. When the VM starts for the first time, the Cloud-Init software inside the VM will apply those settings.</p><p>Proxmox templates together with Cloud-Init can be used to quickly deploy new VMs. A template quickly creates a new VM and Cloud-Init will initialize the new VM so that you only have to set the host name and the initial user account. No more installing the operating system from scratch for every new VM. In this guide, I’m describing how to do this with Debian to spin up headless Debian servers.</p><p>Debian doesn’t provide a special image for this use case, but the <a href="https://cloud.debian.org/images/cloud/">Debian images designed for OpenStack/Cloud</a> come with Cloud-Init support. Check out the <a href="https://pve.proxmox.com/wiki/Cloud-Init_Support">Proxmox’s documentation</a> for details on how Proxmox’s Cloud-Init support works.</p><h2 id="table-of-contents"><span class="mr-2">Table of Contents</span><a href="#table-of-contents" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="#download-a-base-debian-cloud-image">Download a base Debian cloud image</a><ul><li><a href="#how-to-get-the-latest-link-to-use-with-wget">How to get the latest link to use with wget</a><li><a href="#how-to-download-an-image-directly-to-proxmox-server">How to download an image directly to ProxMox server</a></ul><li><a href="#create-a-proxmox-vm-using-the-image">Create a Proxmox VM using the image</a><li><a href="#usage">Usage</a></ul><h1 id="download-a-base-debian-cloud-image">Download a base Debian cloud image</h1><p>We need to download the <code class="language-plaintext highlighter-rouge">.qcow2</code> image file and that can be done from the following command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wget https://cloud.debian.org/images/cloud/bullseye/20220613-1045/debian-11-genericcloud-amd64-20220613-1045.qcow2
</pre></table></code></div></div><p>You will see the following output after running the command.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>brandon@ProxMox:~# wget https://cloud.debian.org/images/cloud/bullseye/20220613-1045/debian-11-genericcloud-amd64-20220613-1045.qcow2
--2022-06-17 19:51:13--  https://cloud.debian.org/images/cloud/bullseye/20220613-1045/debian-11-genericcloud-amd64-20220613-1045.qcow2
Resolving cloud.debian.org (cloud.debian.org)... 194.71.11.173, 194.71.11.165, 194.71.11.163, ...
Connecting to cloud.debian.org (cloud.debian.org)|194.71.11.173|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://laotzu.ftp.acc.umu.se/images/cloud/bullseye/20220613-1045/debian-11-genericcloud-amd64-20220613-1045.qcow2 [following]
--2022-06-17 19:51:15--  https://laotzu.ftp.acc.umu.se/images/cloud/bullseye/20220613-1045/debian-11-genericcloud-amd64-20220613-1045.qcow2
Resolving laotzu.ftp.acc.umu.se (laotzu.ftp.acc.umu.se)... 194.71.11.166, 2001:6b0:19::166
Connecting to laotzu.ftp.acc.umu.se (laotzu.ftp.acc.umu.se)|194.71.11.166|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 253231104 (242M)
Saving to: ‘debian-11-genericcloud-amd64-20220613-1045.qcow2’

debian-11-genericcloud-a 100%[===============================&gt;] 241.50M  14.1MB/s    in 19s     

2022-06-17 19:51:37 (12.6 MB/s) - ‘debian-11-genericcloud-amd64-20220613-1045.qcow2’ saved [253231104/253231104]

brandon@ProxMox:~# 
</pre></table></code></div></div><h2 id="how-to-get-the-latest-link-to-use-with-wget"><span class="mr-2">How to get the latest link to use with wget</span><a href="#how-to-get-the-latest-link-to-use-with-wget" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To be more specific on how we got the command to use from above, I will show you how to find the latest version of the Debian Cloud Image to use.</p><p>Start by visiting the <a href="https://cloud.debian.org/images/cloud/">Debian Official Cloud Images</a> page. The version I want to work with is Bullseye because this is the Debian 11 version and most current.</p><p><img data-src="/project-assets/ProxMoxCloudInitImage/bullseye-debian-cloud-image.png" alt="Debian Bullseye Cloud Image" data-proofer-ignore></p><p>Next click on the current version of the images which for me is <code class="language-plaintext highlighter-rouge">20220613-1045/</code></p><p><img data-src="/project-assets/ProxMoxCloudInitImage/current-cloud-image.png" alt="Current Cloud Image" data-proofer-ignore></p><p>Then choose the <code class="language-plaintext highlighter-rouge">.qcow2</code> image and copy the link address by right clicking it. Paste that after the <code class="language-plaintext highlighter-rouge">wget</code> command in your ProxMox host.</p><p><img data-src="/project-assets/ProxMoxCloudInitImage/qcow2-file-to-download.png" alt="qcow2 file to download" data-proofer-ignore></p><h2 id="how-to-download-an-image-directly-to-proxmox-server"><span class="mr-2">How to download an image directly to ProxMox server</span><a href="#how-to-download-an-image-directly-to-proxmox-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Additionally you can also use a feature in newer versions of ProxMox that will download from a link directly and then automatically add that image to the correct (<code class="language-plaintext highlighter-rouge">/var/lib/vz/template/iso/</code>) directory ProxMox checks in with during creation of a VM so will it appear on the list of image options. This is not strictly for the process we are working on right now, and can be used for simple regular Debian base images, or etc.</p><p><img data-src="/project-assets/ProxMoxCloudInitImage/proxmox-download-feature.png" alt="Promox Download Feature" data-proofer-ignore></p><p>You see the following output upon success:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre>downloading https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-11.3.0-amd64-netinst.iso to /var/lib/vz/template/iso/debian-11.3.0-amd64-netinst.iso
--2022-06-03 16:39:41--  https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-11.3.0-amd64-netinst.iso
Resolving cdimage.debian.org (cdimage.debian.org)... 194.71.11.173, 194.71.11.165, 194.71.11.163, ...
Connecting to cdimage.debian.org (cdimage.debian.org)|194.71.11.173|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://laotzu.ftp.acc.umu.se/debian-cd/current/amd64/iso-cd/debian-11.3.0-amd64-netinst.iso [following]
--2022-06-03 16:39:42--  https://laotzu.ftp.acc.umu.se/debian-cd/current/amd64/iso-cd/debian-11.3.0-amd64-netinst.iso
Resolving laotzu.ftp.acc.umu.se (laotzu.ftp.acc.umu.se)... 194.71.11.166, 2001:6b0:19::166
Connecting to laotzu.ftp.acc.umu.se (laotzu.ftp.acc.umu.se)|194.71.11.166|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 396361728 (378M) [application/x-iso9660-image]
Saving to: '/var/lib/vz/template/iso/debian-11.3.0-amd64-netinst.iso.tmp.480879'
     0K ........ ........ ........ ........  8% 8.19M 42s
 32768K ........ ........ ........ ........ 16% 13.7M 31s
 65536K ........ ........ ........ ........ 25% 13.7M 25s
 98304K ........ ........ ........ ........ 33% 12.1M 22s
131072K ........ ........ ........ ........ 42% 13.7M 18s
163840K ........ ........ ........ ........ 50% 13.8M 15s
196608K ........ ........ ........ ........ 59% 13.8M 13s
229376K ........ ........ ........ ........ 67% 11.7M 10s
262144K ........ ........ ........ ........ 76% 13.7M 7s
294912K ........ ........ ........ ........ 84% 13.8M 5s
327680K ........ ........ ........ ........ 93% 13.7M 2s
360448K ........ ........ ........ ..      100% 11.2M=30s
2022-06-03 16:40:15 (12.5 MB/s) - '/var/lib/vz/template/iso/debian-11.3.0-amd64-netinst.iso.tmp.480879' saved [396361728/396361728]
download of 'https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-11.3.0-amd64-netinst.iso' to '/var/lib/vz/template/iso/debian-11.3.0-amd64-netinst.iso' finished
TASK OK
</pre></table></code></div></div><h1 id="create-a-proxmox-vm-using-the-image">Create a Proxmox VM using the image</h1><p>The commands here should be relatively self explanatory but in general we are creating a VM (VMID=9500) with basic resources (2 cores, 2048MB), assigning networking to a virtio adapter on vmbr0, importing the image to storage (either <code class="language-plaintext highlighter-rouge">local</code> or <code class="language-plaintext highlighter-rouge">local-lvm</code>), setting disk 0 to use the image, setting boot drive to disk, setting the cloud init stuff to ide2 (which apparently appears as a CD-ROM to the VM, at least upon inital boot), and adding a virtual serial port.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>qm create 9500 <span class="nt">--name</span> Debian11CloudInit <span class="nt">--net0</span> virtio,bridge<span class="o">=</span>vmbr0
qm importdisk 9500 debian-11-genericcloud-amd64-20220613-1045.qcow2 local-lvm
qm <span class="nb">set </span>9500 <span class="nt">--scsihw</span> virtio-scsi-pci <span class="nt">--scsi0</span> local-lvm:vm-9500-disk-0
qm <span class="nb">set </span>9500 <span class="nt">--ide2</span> local-lvm:cloudinit
qm <span class="nb">set </span>9500 <span class="nt">--boot</span> c <span class="nt">--bootdisk</span> scsi0
qm <span class="nb">set </span>9500 <span class="nt">--serial0</span> socket <span class="nt">--vga</span> serial0
qm <span class="nb">set </span>9500 <span class="nt">--agent</span> <span class="nv">enabled</span><span class="o">=</span>1 <span class="c">#optional but recommended</span>
qm template 9500
</pre></table></code></div></div><p>Here are the details to the command as they appear:</p><ol><li>Create a new VM with ID 900 using VirtIO networking drivers.<li>Import the qcow Debian image as a disk to the new VM. The disk will be called <code class="language-plaintext highlighter-rouge">local-lvm:vm-9500-disk-0</code>.<li>Attach the imported disk as a VirtIO SCSI device to the VM.<li>Attach a drive for the Cloud-Init config to the VM.<li>Set the VM to boot from the imported disk image.<li>Add a serial console to the VM, which is needed by OpenStack/ProxMox.<li>Enable the qemu-guest-agent for the VM – this is an optional setting, but I do recommend it because it will be useful if you are going to be using this for something like Terraform later on to automate the creation of VMs.<li>Convert the VM into a template.</ol><h1 id="usage">Usage</h1><p>To deploy a new server VM based on the template using the ID and name of your choice, execute the following command on the Proxmox host:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>qm clone 9500 9000 <span class="nt">--name</span> NEW-VM
</pre></table></code></div></div><p>After the new VM is created, you can finish the setup in the Proxmox web interface with the following steps:</p><ol><li>In the <em>Cloud-Init</em> tab of the VM, configure the name of the default user and the public SSH key you want to use for authentication.<li>In the Options tab, enable the QEMU Guest Agent if you did not from the commands above.<li>In the <em>Hardware</em> tab, select the <code class="language-plaintext highlighter-rouge">scsi0</code> hard disk and click Resize disk. The default size of the Debian image is 2 GiB. Specify the amount you want the disk to be increased by (e.g. 30 GiB for a total size of 32 GiB).</ol><p>Everything is ready to go! Start the VM, run a system upgrade, and install the QEMU guest agent:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt full-upgrade
<span class="nb">sudo </span>apt <span class="nb">install </span>qemu-guest-agent
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/homelab/'>Homelab</a>, <a href='/categories/proxmox/'>ProxMox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/hypervisor/" class="post-tag no-text-decoration" >hypervisor</a> <a href="/tags/proxmox/" class="post-tag no-text-decoration" >proxmox</a> <a href="/tags/cloudinit/" class="post-tag no-text-decoration" >cloudinit</a> <a href="/tags/automation/" class="post-tag no-text-decoration" >automation</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Create+a+Debian+Cloud-Init+Template+on+Proxmox+-+OchoaProjects&url=https%3A%2F%2Fochoaprojects.github.io%2Fposts%2FProxMoxCloudInitImage%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Create+a+Debian+Cloud-Init+Template+on+Proxmox+-+OchoaProjects&u=https%3A%2F%2Fochoaprojects.github.io%2Fposts%2FProxMoxCloudInitImage%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fochoaprojects.github.io%2Fposts%2FProxMoxCloudInitImage%2F&text=Create+a+Debian+Cloud-Init+Template+on+Proxmox+-+OchoaProjects" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/ProxMoxSetupInstall/">ProxMox Setup and Installation</a><li><a href="/posts/AboutMeAndTopology/">About Me and Homelab Topology</a><li><a href="/posts/PlexAutomation/">Plex Automation</a><li><a href="/posts/ProxMoxCloudInitImage/">Create a Debian Cloud-Init Template on Proxmox</a><li><a href="/posts/ProvisionDockerWithAnsible/">Provision a Linux Server With Docker Using Ansible</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/proxmox/">proxmox</a> <a class="post-tag" href="/tags/terraform/">terraform</a> <a class="post-tag" href="/tags/cloudinit/">cloudinit</a> <a class="post-tag" href="/tags/containers/">containers</a> <a class="post-tag" href="/tags/ec2/">ec2</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/DeployingVMsWithTerraformInProxMox/"><div class="card-body"> <em class="small" data-ts="1654448400" data-df="ll" > Jun 5, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Deploying VMs With Terraform In ProxMox</h3><div class="text-muted small"><p> Leveraging our ProxMox cloud-init templates to deploy VMs entirely through Terraform quickly and easily. Table of Contents Prep a cloud-init template to use with Terraform Install qe...</p></div></div></a></div><div class="card"> <a href="/posts/ProxMoxSetupInstall/"><div class="card-body"> <em class="small" data-ts="1656781200" data-df="ll" > Jul 2, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>ProxMox Setup and Installation</h3><div class="text-muted small"><p> Proxmox VE is an open-source server platform for enterprise virtualization. As a Debian-based Linux distribution, Proxmox uses a modified Ubuntu kernel to run multiple virtual machines and containe...</p></div></div></a></div><div class="card"> <a href="/posts/TerraformWithAWS/"><div class="card-body"> <em class="small" data-ts="1656435600" data-df="ll" > Jun 28, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Automating AWS VPC and EC2 Instances using Terraform</h3><div class="text-muted small"><p> Terraform is a powerful tool that allows us to automate infrastructure in our cloud providers and much more. Using terraform to automate the building and configuration of our AWS enviornment to be ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/SonyRemotePlayOnLinux/" class="btn btn-outline-primary" prompt="Older"><p>How to use Sony Remote Play on Linux</p></a> <a href="/posts/DeployingVMsWithTerraformInProxMox/" class="btn btn-outline-primary" prompt="Newer"><p>Deploying VMs With Terraform In ProxMox</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/ochoaprojects">Brandon Ochoa</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> hosted on Github</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/proxmox/">proxmox</a> <a class="post-tag" href="/tags/terraform/">terraform</a> <a class="post-tag" href="/tags/cloudinit/">cloudinit</a> <a class="post-tag" href="/tags/containers/">containers</a> <a class="post-tag" href="/tags/ec2/">ec2</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
