<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="DevOps the GitLab Way" /><meta property="og:locale" content="en" /><meta name="description" content="Have you been searching for a platform to host your code, and build your DevOps workflow and processes all in one place? Why not use GitLab for CI/CD pipelines? GitLab lets you host your application code and use the GitLab CI CD feature to continuously test, build and deploy your application on every code change." /><meta property="og:description" content="Have you been searching for a platform to host your code, and build your DevOps workflow and processes all in one place? Why not use GitLab for CI/CD pipelines? GitLab lets you host your application code and use the GitLab CI CD feature to continuously test, build and deploy your application on every code change." /><link rel="canonical" href="https://ochoaprojects.github.io/posts/2022-DevOpsTheGitLabWay/" /><meta property="og:url" content="https://ochoaprojects.github.io/posts/2022-DevOpsTheGitLabWay/" /><meta property="og:site_name" content="OchoaProjects" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-10-11T10:00:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="DevOps the GitLab Way" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-02-04T19:11:51-08:00","datePublished":"2022-10-11T10:00:00-07:00","description":"Have you been searching for a platform to host your code, and build your DevOps workflow and processes all in one place? Why not use GitLab for CI/CD pipelines? GitLab lets you host your application code and use the GitLab CI CD feature to continuously test, build and deploy your application on every code change.","headline":"DevOps the GitLab Way","mainEntityOfPage":{"@type":"WebPage","@id":"https://ochoaprojects.github.io/posts/2022-DevOpsTheGitLabWay/"},"url":"https://ochoaprojects.github.io/posts/2022-DevOpsTheGitLabWay/"}</script><title>DevOps the GitLab Way | OchoaProjects</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="OchoaProjects"><meta name="application-name" content="OchoaProjects"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/project-assets/Brandon-Ochoa-Github.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">OchoaProjects</a></div><div class="site-subtitle font-italic">A place where I post my projects and things that I am learning or working on.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/ochoaprojects" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/brandon-ochoa/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.youtube.com/@ochoaprojects9930" aria-label="youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['brandon','ochoaprojects.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>DevOps the GitLab Way</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>DevOps the GitLab Way</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1665507600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 11, 2022 </em> </span> <span> Updated <em class="" data-ts="1675566711" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Feb 4, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/ochoaprojects">Brandon Ochoa</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1304 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><p>Have you been searching for a platform to host your code, and build your DevOps workflow and processes all in one place? Why not use GitLab for CI/CD pipelines? GitLab lets you host your application code and use the GitLab CI CD feature to continuously test, build and deploy your application on every code change.</p><h2 id="table-of-contents"><span class="mr-2">Table of Contents</span><a href="#table-of-contents" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="#prerequisites">Prerequisites</a><li><a href="#initializing-a-gitlab-project">Initializing a GitLab Project</a><li><a href="#configuring-jobs-on-gitlab">Configuring Jobs on GitLab</a><li><a href="#securing-credentials-by-creating-secret-variables">Securing Credentials by Creating Secret Variables</a><li><a href="#building-and-pushing-a-docker-image-to-docker-hub">Building and Pushing a Docker Image to Docker Hub</a><li><a href="#configuring-stages-on-the-gitlab-ci-cd-pipeline">Configuring Stages on the GitLab CI CD pipeline</a></ul><h1 id="prerequisites">Prerequisites</h1><ul><li>A <a href="https://about.gitlab.com/">GitLab</a> account, a repository already set up, and a <a href="https://kp2.in.htwg-konstanz.de/git/help/user/profile/personal_access_tokens.md">personal access token</a>.<li>A <a href="https://hub.docker.com/">Docker Hub</a> account and a repository.</ul><h1 id="initializing-a-gitlab-project">Initializing a GitLab Project</h1><p>Before configuring a CI/CD pipeline on GitLab, you must first have a repository on GitLab that houses your application. This tutorial uses a Python flask application to illustrate GitLab CI CD in action.</p><p>Clone the following <a href="https://gitea.ochoaprojects.com/brandon/gitlab-devop-scripts.git">repo</a>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>git clone https://gitea.ochoaprojects.com/brandon/gitlab-devop-scripts.git
</pre></table></code></div></div><p>Once cloned, open the directory containing your files from your root directory and open it up with your preferred code editor.</p><p>Next, run the command below to spin up <a href="https://flask.palletsprojects.com/en/2.1.x/cli/">flask run</a> the flask application.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>flask run
</pre></table></code></div></div><p>The output below indicates that the flask application is entirely functional and error-free.</p><p><img data-src="/project-assets/DevOpsTheGitLabWay/flask-run.png" alt="Flask Run" data-proofer-ignore></p><p>Lastly, <a href="https://www.theserverside.com/blog/Coffee-Talk-Java-News-Stories-and-Opinions/How-to-add-and-push-an-existing-project-to-GitLab">push the application up to your GitLab repository</a>.</p><h1 id="configuring-jobs-on-gitlab">Configuring Jobs on GitLab</h1><p>After initializing your GitLab project, you’ll need a way to execute tasks on your CI/CD pipeline. How? By configuring Jobs where you define tasks in a YAML file.</p><p>You’ll write the CI/CD pipeline as code in a YAML file, which GitLab will use to perform the CI/CD pipeline for your project.</p><p>There are two options involved when creating the YAML file:</p><ul><li>Create, and push the file in your project directory locally from your machine alongside the pipeline configurations to your remote GitLab repository.<li>Create the file directly on your GitLab repository via the GitLab UI.</ul><p>In this example, you’ll create the YAML file directly on your GitLab repository via the GitLab UI:</p><p>Click on the (+) icon shown below in your project’s root directory of your GitLab repository to initialize creating the (.gitlab-ci.yaml) file. Your browser redirects to a page where you can configure the new YAML file (step two).</p><p><img data-src="/project-assets/DevOpsTheGitLabWay/add-new-file-gitlab-ui.png" alt="Add New File Gitlab UI" data-proofer-ignore></p><p>Next, type in <code class="language-plaintext highlighter-rouge">.gitlab-ci.yml</code> in the input field with the filename placeholder, as shown below.</p><p><img data-src="/project-assets/DevOpsTheGitLabWay/creating-gitlab-ci-yaml-file.png" alt="Creating GitLab CI Yaml Files" data-proofer-ignore></p><p>Add the code snippets below to the <code class="language-plaintext highlighter-rouge">.gitlab-ci.yml</code> file, which runs the test for the Python flask application.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="na">run_tests</span><span class="pi">:</span>
    <span class="c1"># Use GitLab-managed runner with a python:3.9-slim-buster image to run the job</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">python:3.9-slim-buster</span>
    <span class="na">before_script</span><span class="pi">:</span> 
        <span class="c1"># Update the system package index</span>
        <span class="pi">-</span> <span class="s">apt-get update</span>
        <span class="c1"># Install Python3 and pip</span>
        <span class="pi">-</span> <span class="s">apt-get install -y python3-dev python3-pip</span>
        <span class="c1"># Install Flask and pytest</span>
        <span class="pi">-</span> <span class="s">pip3 install Flask pytest</span>
    <span class="na">script</span><span class="pi">:</span>
        <span class="c1"># Run the pytest command to run the test for the Python flask application. </span>
        <span class="pi">-</span> <span class="s">pytest</span>
</pre></table></code></div></div><p>Now, scroll down to the page’s bottom, and click on the Commit changes button to commit the changes. Doing so makes GitLab detect the pipeline configuration code and run the job.</p><p><img data-src="/project-assets/DevOpsTheGitLabWay/commit-changes.png" alt="Commit Changes" data-proofer-ignore></p><p>Lastly, navigate to the CI/CD section (left panel), and click on the Pipelines tab to view your pipeline.</p><p>You’ll see that the pipeline is currently in running status, as shown below.</p><p><img data-src="/project-assets/DevOpsTheGitLabWay/running-pipeline.png" alt="Running Pipeline" data-proofer-ignore></p><p>Once executed successfully, your pipeline’s status changes to passed, which indicates your job ran successfully.</p><p><img data-src="/project-assets/DevOpsTheGitLabWay/passed-pipeline.png" alt="Passed Pipeline" data-proofer-ignore></p><h1 id="securing-credentials-by-creating-secret-variables">Securing Credentials by Creating Secret Variables</h1><p>You’ve just successfully executed your first job. And now, you’re almost ready to build and push the Docker image for the Python flask project to both Docker Hub and GitLab container registries.</p><p>But first, you’ll need a way to store your login credentials for Docker Hub and GitLab securely. What’s that secure way? You’ll create secret variables to hold these credentials and keep them away from public eyes.</p><p>Navigate to Settings (left panel), and click on the CI/CD tab, as shown below, to create a secret variable using GitLab project variables.</p><p><img data-src="/project-assets/DevOpsTheGitLabWay/open-cicd-settings.png" alt="Open CI/CD Settings" data-proofer-ignore></p><p>Next, scroll down on the new page, click on the Variables sub-section, and click Expand (top-right of the section) to expand the Variables section.</p><p><img data-src="/project-assets/DevOpsTheGitLabWay/expand-variables.png" alt="Expand Variables" data-proofer-ignore></p><p>Once expanded, click Add variable (bottom-left) to add a secret variable.</p><p><img data-src="/project-assets/DevOpsTheGitLabWay/add-variable.png" alt="Add Variable" data-proofer-ignore></p><p>Now, configure the new secret variable with the following:</p><ul><li><code class="language-plaintext highlighter-rouge">Key</code> – DOCKER_USERNAME<li><code class="language-plaintext highlighter-rouge">Value</code> – <em>Input your Docker Hub username.</em></ul><p><img data-src="/project-assets/DevOpsTheGitLabWay/configure-variable.png" alt="Configure Variable" data-proofer-ignore></p><p>Finally, repeat step four, and add more variables with the following details:</p><ul><li><code class="language-plaintext highlighter-rouge">Key</code> – DOCKER_PASSWORD<li><p><code class="language-plaintext highlighter-rouge">Value</code> – <em>Provide your Docker Hub password.</em></p><li><code class="language-plaintext highlighter-rouge">Key</code> - GITLAB_USERNAME<li><p><code class="language-plaintext highlighter-rouge">Value</code> - <em>Input your GitLab username.</em></p><li><code class="language-plaintext highlighter-rouge">Key</code> – GITLAB_ACCESS_TOKEN<li><code class="language-plaintext highlighter-rouge">Value</code> – <em>Input your GitLab access token.</em></ul><p>You should now have four secret variables, as shown below.</p><p><img data-src="/project-assets/DevOpsTheGitLabWay/completed-variables.png" alt="Completed Variables" data-proofer-ignore></p><h1 id="building-and-pushing-a-docker-image-to-docker-hub">Building and Pushing a Docker Image to Docker Hub</h1><p>With your secrets kept a secret, it’s time to configure your second job. This job will build and deploy a Docker image for the Python flask application to Docker Hub.</p><p>Navigate to the CI/CD Pipeline Editor as you’ll need to add configurations to the pipeline.</p><p>Next, add the following code <code class="language-plaintext highlighter-rouge">at the top of the run-test block</code>. Be sure to replace dockerhub-user with your Docker Hub username.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="na">variables</span><span class="pi">:</span>
    <span class="na">IMAGE_NAME</span><span class="pi">:</span> <span class="s">&lt;dockerhub-user&gt;/flask-app</span>
    <span class="na">IMAGE_TAG</span><span class="pi">:</span> <span class="s">flask-app-1.0</span>
</pre></table></code></div></div><p><img data-src="/project-assets/DevOpsTheGitLabWay/added-variables-to-pipeline-editor.png" alt="Added Variables to Pipeline Editor" data-proofer-ignore></p><p>Add the following code <code class="language-plaintext highlighter-rouge">below the run_test block</code>, which builds a Docker image for the Python flask application. Be sure to replace <code class="language-plaintext highlighter-rouge">gitlab-user</code> with your GitLab username and <code class="language-plaintext highlighter-rouge">project-name</code> (in this example, mine is “gitlab-devop-scripts”) in the script block.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="na">build_image</span><span class="pi">:</span>
    <span class="c1"># Downloads a Docker client (docker:20.10.16).</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">docker:20.10.16</span>
    <span class="c1"># Connects to a Docker daemon.</span>
    <span class="na">services</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">docker:20.10.16-dind</span>
    <span class="c1"># Create a certificate directory (DOCKER_TLS_CERTDIR) to enable the </span>
    <span class="c1"># Docker client and Docker daemon to share the same certificate directory. </span>
    <span class="c1"># Enable Docker client and Docker daemon to authenticate each other.</span>
    <span class="na">variables</span><span class="pi">:</span>
        <span class="na">DOCKER_TLS_CERTDIR</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/certs'</span>
    <span class="c1"># Authenticate GitLab with login parameters described as secret variables.</span>
    <span class="na">before_script</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD</span> 
        <span class="pi">-</span> <span class="s">docker login registry.gitlab.com -u $GITLAB_USERNAME -p $GITLAB_ACCESS_TOKEN</span>
    <span class="c1"># Build and push the flask image to DockerHub and GitLab container registry.</span>
    <span class="na">script</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">docker build -t $IMAGE_NAME:$IMAGE_TAG .</span>
        <span class="pi">-</span> <span class="s">docker push $IMAGE_NAME:$IMAGE_TAG</span>
        <span class="pi">-</span> <span class="s">docker build -t registry.gitlab.com/gitlab-user/project-name .</span>
        <span class="pi">-</span> <span class="s">docker push registry.gitlab.com/gitlab-user/project-name</span>
</pre></table></code></div></div><p><img data-src="/project-assets/DevOpsTheGitLabWay/added-build-image-to-pipeline-editor.png" alt="Added Build Image To Pipeline Editor" data-proofer-ignore></p><p>Now, click on Commit changes again to save the changes, and trigger the updated pipeline.</p><p><img data-src="/project-assets/DevOpsTheGitLabWay/commit-changes.png" alt="Commit Changes" data-proofer-ignore></p><p>You should now have the following output, which indicates your build is successful.</p><p><img data-src="/project-assets/DevOpsTheGitLabWay/build-and-push-passed.png" alt="Build and Push Passed" data-proofer-ignore></p><p>We should also now see that our container registry push was successful by navigating to <code class="language-plaintext highlighter-rouge">Package and registries &gt; Container Registry</code> and the following output will be shown below.</p><p>Navigate to the Packages &amp; Registries (left panel) → Container Registry to confirm your Python flask image has been pushed to the GitLab container registry, as shown below.</p><p><img data-src="/project-assets/DevOpsTheGitLabWay/container-registry.png" alt="Container Registry" data-proofer-ignore></p><p>Finally, switch to your Docker account and verify your Python flask application has been pushed to your Docker Hub registry.</p><p><img data-src="/project-assets/DevOpsTheGitLabWay/confirmed-docker-hub-push.png" alt="Confirmed Docker Hub Pushed" data-proofer-ignore></p><h1 id="configuring-stages-on-the-gitlab-ci-cd-pipeline">Configuring Stages on the GitLab CI CD pipeline</h1><p>Currently, each job in your pipeline is executed in isolation and running regardless of if any job is not successful, which is not good practice.</p><p>The best way to configure a pipeline is to make jobs execute accordingly, one after the other. With this behavior, if one job fails, other subsequent jobs will not execute.</p><p>Navigate to the Pipeline Editor and add the following code below the variables block in your pipeline.</p><p>The code below adds stages to the pipeline, referenced from jobs in the pipeline.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="na">stages</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">test</span>
    <span class="pi">-</span> <span class="s">build</span>
</pre></table></code></div></div><p>Reference the stages in both the <code class="language-plaintext highlighter-rouge">run_test</code> and <code class="language-plaintext highlighter-rouge">build_image</code> blocks, as shown below.</p><p><img data-src="/project-assets/DevOpsTheGitLabWay/referencing-the-stages-in-yml.png" alt="Referencing the Stages in YAML" data-proofer-ignore></p><p>Lastly, commit your changes to the pipeline, and navigate to Pipelines under the CI/CD section (left panel).</p><p>If all goes well, you’ll see each job executed one after the other in the Stages column, as shown below.</p><p><img data-src="/project-assets/DevOpsTheGitLabWay/viewing-stages-in-pipeline.png" alt="Viewing Stages in Pipeline" data-proofer-ignore></p><p>Once the run_tests job is done executing successfully, the build job begins immediately.</p><p><img data-src="/project-assets/DevOpsTheGitLabWay/viewing-second-stage-in-pipeline.png" alt="Viewing Second Stage in Pipeline" data-proofer-ignore></p><p>When the build job is executed successfully, you’ll see the following output showing two green checks under the Stages column.</p><p><img data-src="/project-assets/DevOpsTheGitLabWay/completed-stages-in-pipeline.png" alt="Completed Stages in Pipeline" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ci-cd/'>CI/CD</a>, <a href='/categories/gitlab/'>GitLab</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/gitlab/" class="post-tag no-text-decoration" >gitlab</a> <a href="/tags/devops/" class="post-tag no-text-decoration" >devops</a> <a href="/tags/ci/" class="post-tag no-text-decoration" >ci</a> <a href="/tags/cd/" class="post-tag no-text-decoration" >cd</a> <a href="/tags/docker/" class="post-tag no-text-decoration" >docker</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=DevOps+the+GitLab+Way+-+OchoaProjects&url=https%3A%2F%2Fochoaprojects.github.io%2Fposts%2F2022-DevOpsTheGitLabWay%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=DevOps+the+GitLab+Way+-+OchoaProjects&u=https%3A%2F%2Fochoaprojects.github.io%2Fposts%2F2022-DevOpsTheGitLabWay%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fochoaprojects.github.io%2Fposts%2F2022-DevOpsTheGitLabWay%2F&text=DevOps+the+GitLab+Way+-+OchoaProjects" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/ProxMoxSetupInstall/">ProxMox Setup and Installation</a><li><a href="/posts/AboutMeAndTopology/">About Me and Homelab Topology</a><li><a href="/posts/PlexAutomation/">Plex Automation</a><li><a href="/posts/ProxMoxCloudInitImage/">Create a Debian Cloud-Init Template on Proxmox</a><li><a href="/posts/ProvisionDockerWithAnsible/">Provision a Linux Server With Docker Using Ansible</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/proxmox/">proxmox</a> <a class="post-tag" href="/tags/terraform/">terraform</a> <a class="post-tag" href="/tags/cloudinit/">cloudinit</a> <a class="post-tag" href="/tags/containers/">containers</a> <a class="post-tag" href="/tags/ec2/">ec2</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/PlexAutomation/"><div class="card-body"> <em class="small" data-ts="1657126800" data-df="ll" > Jul 6, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Plex Automation</h3><div class="text-muted small"><p> How to build a complete Plex server with full automation for accepting and processing plex requests without any manual work. Table of Contents The Stack Tips for managing your hard drives ...</p></div></div></a></div><div class="card"> <a href="/posts/PortainerDocumented/"><div class="card-body"> <em class="small" data-ts="1654621200" data-df="ll" > Jun 7, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Portainer Documented</h3><div class="text-muted small"><p> Portainer is a simple and lightweight, but powerful application that is used to provide a web management interface that you can use to perform functions on your Docker host. Table of Contents U...</p></div></div></a></div><div class="card"> <a href="/posts/ProvisionDockerWithAnsible/"><div class="card-body"> <em class="small" data-ts="1655053200" data-df="ll" > Jun 12, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Provision a Linux Server With Docker Using Ansible</h3><div class="text-muted small"><p> Using Ansible to provision remote servers with Docker and Docker-compose. Table of Contents Prerequisites Structure Files provisioning/hosts.yml provisioning/site.yml ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/SessionManagerAWS/" class="btn btn-outline-primary" prompt="Older"><p>Session Manager for AWS</p></a> <a href="/posts/FlaskAppWithSimpleSearch/" class="btn btn-outline-primary" prompt="Newer"><p>Building a Search Feature in a Python Flask App</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/ochoaprojects">Brandon Ochoa</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> hosted on Github</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/proxmox/">proxmox</a> <a class="post-tag" href="/tags/terraform/">terraform</a> <a class="post-tag" href="/tags/cloudinit/">cloudinit</a> <a class="post-tag" href="/tags/containers/">containers</a> <a class="post-tag" href="/tags/ec2/">ec2</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
