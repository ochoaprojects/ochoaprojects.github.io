<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Deploying Kubernetes With Rancher and Proxmox" /><meta property="og:locale" content="en" /><meta name="description" content="Rancher is a popular open-source platform that provides a complete solution for managing Kubernetes clusters. With Rancher, users can easily deploy, manage, and scale their Kubernetes clusters across multiple environments, including on-premise, cloud, and hybrid deployments. Rancher also offers a user-friendly interface for managing Kubernetes, making it an ideal solution for teams with varying levels of expertise. In this post, we will explore the features and benefits of Rancher for Kubernetes, as well as how it can help you streamline your Kubernetes management processes." /><meta property="og:description" content="Rancher is a popular open-source platform that provides a complete solution for managing Kubernetes clusters. With Rancher, users can easily deploy, manage, and scale their Kubernetes clusters across multiple environments, including on-premise, cloud, and hybrid deployments. Rancher also offers a user-friendly interface for managing Kubernetes, making it an ideal solution for teams with varying levels of expertise. In this post, we will explore the features and benefits of Rancher for Kubernetes, as well as how it can help you streamline your Kubernetes management processes." /><link rel="canonical" href="https://ochoaprojects.github.io/posts/DeployingKubernetesWithRancher/" /><meta property="og:url" content="https://ochoaprojects.github.io/posts/DeployingKubernetesWithRancher/" /><meta property="og:site_name" content="OchoaProjects" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-02-23T09:00:00-08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Deploying Kubernetes With Rancher and Proxmox" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-02-28T17:03:25-08:00","datePublished":"2023-02-23T09:00:00-08:00","description":"Rancher is a popular open-source platform that provides a complete solution for managing Kubernetes clusters. With Rancher, users can easily deploy, manage, and scale their Kubernetes clusters across multiple environments, including on-premise, cloud, and hybrid deployments. Rancher also offers a user-friendly interface for managing Kubernetes, making it an ideal solution for teams with varying levels of expertise. In this post, we will explore the features and benefits of Rancher for Kubernetes, as well as how it can help you streamline your Kubernetes management processes.","headline":"Deploying Kubernetes With Rancher and Proxmox","mainEntityOfPage":{"@type":"WebPage","@id":"https://ochoaprojects.github.io/posts/DeployingKubernetesWithRancher/"},"url":"https://ochoaprojects.github.io/posts/DeployingKubernetesWithRancher/"}</script><title>Deploying Kubernetes With Rancher and Proxmox | OchoaProjects</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="OchoaProjects"><meta name="application-name" content="OchoaProjects"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/project-assets/Brandon-Ochoa-Github.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">OchoaProjects</a></div><div class="site-subtitle font-italic">A place where I post my projects and things that I am learning or working on.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/ochoaprojects" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/brandon-ochoa/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.youtube.com/@ochoaprojects9930" aria-label="youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['brandon','ochoaprojects.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Deploying Kubernetes With Rancher and Proxmox</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Deploying Kubernetes With Rancher and Proxmox</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1677171600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Feb 23, 2023 </em> </span> <span> Updated <em class="" data-ts="1677632605" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Feb 28, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/ochoaprojects">Brandon Ochoa</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1112 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><p>Rancher is a popular open-source platform that provides a complete solution for managing Kubernetes clusters. With Rancher, users can easily deploy, manage, and scale their Kubernetes clusters across multiple environments, including on-premise, cloud, and hybrid deployments. Rancher also offers a user-friendly interface for managing Kubernetes, making it an ideal solution for teams with varying levels of expertise. In this post, we will explore the features and benefits of Rancher for Kubernetes, as well as how it can help you streamline your Kubernetes management processes.</p><h2 id="table-of-contents"><span class="mr-2">Table of Contents</span><a href="#table-of-contents" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="#find-a-host-machine">Find a host machine</a><li><a href="#create-3-or-more-virtual-machines-in-proxmox">Create 3 or more virtual machines in Proxmox</a><ul><li><a href="#maintf">main.tf</a><li><a href="#varstf">vars.tf</a></ul><li><a href="#set-up-update-upgrade-install-docker">Set-up Update Upgrade Install Docker</a><li><a href="#set-up-rancher-k3s">Set up Rancher K3s</a><li><a href="#create-your-kubernetes-cluster">Create your Kubernetes Cluster</a><li><a href="#join-your-master-and-worker-nodes-to-the-cluster">Join your master and worker nodes to the cluster</a><ul><li><a href="#complete">Complete</a></ul></ul><blockquote class="prompt-info"><div><p>The contents of this post are for demo purposes only. Secrets will be gone before posting and therefore left with intention.</p></div></blockquote><h1 id="find-a-host-machine">Find a host machine</h1><p>Personally I am deploying this on my Proxmox cluser through a Debian VM. You can choose anything that works for you though.</p><p><img data-src="/project-assets/DeployingKubernetesWithRancher/proxmox-vms.png" alt="ProxMox VMs" data-proofer-ignore></p><h1 id="create-3-or-more-virtual-machines-in-proxmox">Create 3 or more virtual machines in Proxmox</h1><p>It is necessary to generate a minimum of 3 virtual machines for this task. However, I have decided to use 4 virtual machines to have an additional worker node that can efficiently manage my workloads. Among the virtual machines, the GUI node will be assigned for hosting our Rancher GUI, the master node will function as our etcd, scheduling, and control plane, while the worker nodes will take care of running our workloads.</p><p>In a previous post I went over how to deploy VMs by using Terraform. I will be using that method to deploy my VMs to my Proxmox cluster.</p><p>Here is what my Terraform code looks like for this method:</p><h3 id="maintf"><span class="mr-2">main.tf</span><a href="#maintf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div file="main.tf" class="language-terraform highlighter-rouge"><div class="code-header"> <span data-label-text="main.tf"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre><td class="rouge-code"><pre><span class="c1">#Configure ProxMox provider using Telmate found here https://github.com/Telmate/terraform-provider-proxmox</span>
<span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">proxmox</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"telmate/proxmox"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"2.7.4"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1">#Configure ProxMox API user/permissions and API url</span>
<span class="k">provider</span> <span class="s2">"proxmox"</span> <span class="p">{</span>
  <span class="nx">pm_api_url</span> <span class="p">=</span> <span class="s2">"https://192.168.2.11:8006/api2/json"</span>

  <span class="nx">pm_api_token_id</span> <span class="p">=</span> <span class="s2">"terraform@pam!terraform_token"</span>

  <span class="nx">pm_api_token_secret</span> <span class="p">=</span> <span class="s2">"&lt;your-secret-here&gt;"</span>

  <span class="nx">pm_tls_insecure</span> <span class="p">=</span> <span class="kc">true</span>
<span class="p">}</span>
<span class="c1">#Configure Proxmox Resources Here</span>
<span class="k">resource</span> <span class="s2">"proxmox_vm_qemu"</span> <span class="s2">"Kubernetes-Node"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="p">=</span> <span class="mi">4</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"Kubernetes-Node-</span><span class="k">${</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="k">}</span><span class="s2">"</span>
  <span class="nx">vmid</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">vmid</span> <span class="err">+</span> <span class="p">(</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span> <span class="p">*</span> <span class="mi">100</span><span class="p">)</span>

  <span class="nx">target_node</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">proxmox_host</span>

  <span class="nx">clone</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">template_name</span>
  <span class="c1">#Basic VM settings here</span>
  <span class="nx">agent</span> <span class="p">=</span> <span class="mi">1</span> <span class="c1"># QEMU Guest Agent, 1 means installing the guest agent on this VM is set to True</span>
  <span class="nx">os_type</span> <span class="p">=</span> <span class="s2">"cloud-init"</span>
  <span class="nx">cores</span> <span class="p">=</span> <span class="mi">2</span>
  <span class="nx">sockets</span> <span class="p">=</span> <span class="mi">1</span>
  <span class="nx">cpu</span> <span class="p">=</span> <span class="s2">"host"</span>
  <span class="nx">memory</span> <span class="p">=</span> <span class="mi">4096</span>
  <span class="nx">scsihw</span> <span class="p">=</span> <span class="s2">"virtio-scsi-pci"</span>
  <span class="nx">bootdisk</span> <span class="p">=</span> <span class="s2">"scsi0"</span>

  <span class="nx">disk</span> <span class="p">{</span>
    <span class="nx">slot</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="c1"># set disk size here. leave it small for testing because expanding the disk takes time.</span>
    <span class="nx">size</span> <span class="p">=</span> <span class="s2">"50G"</span>
    <span class="nx">type</span> <span class="p">=</span> <span class="s2">"scsi"</span>
    <span class="nx">storage</span> <span class="p">=</span> <span class="s2">"local-lvm"</span>
    <span class="nx">iothread</span> <span class="p">=</span> <span class="mi">1</span>
  <span class="p">}</span>
  
  <span class="c1"># if you want two NICs, just copy this whole network section and duplicate it</span>
  <span class="nx">network</span> <span class="p">{</span>
    <span class="nx">model</span> <span class="p">=</span> <span class="s2">"virtio"</span>
    <span class="nx">bridge</span> <span class="p">=</span> <span class="s2">"vmbr0"</span>
  <span class="p">}</span>
  <span class="nx">lifecycle</span> <span class="p">{</span>
    <span class="nx">ignore_changes</span> <span class="p">=</span> <span class="p">[</span>
      <span class="nx">network</span><span class="p">,</span>
    <span class="p">]</span>
  <span class="p">}</span>
  
  <span class="c1"># sshkeys set using variables. the variable contains the text of the key.</span>
  <span class="nx">sshkeys</span> <span class="p">=</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
  ${var.ssh_key}
</span><span class="no">  EOF
</span><span class="p">}</span>
</pre></table></code></div></div><p>Things worth noting with the Terraform code above would be the following:</p><ul><li><code class="language-plaintext highlighter-rouge">count</code> - I have this set to 4 but you can simply change this number depending on how many nodes you intend to deploy for your Kubernetes cluster.<li><code class="language-plaintext highlighter-rouge">vmid</code> - I have this starting at 100 from the <code class="language-plaintext highlighter-rouge">vars.tf</code> file with the default and then I multiply by 100 for every VM deployed after that. This means that my VMs will deployed with the IDs such as Node-1(100), Node-2(200), Node-3(300), etc.. This is just what I’ve grown accustomed to using, but choose whatever you like here.<li><code class="language-plaintext highlighter-rouge">disk/size</code> - When using Rancher, later we will deploy our cluster by using RKE which puts all the Kubernetes components in their own docker containers when deploying to the nodes. These images that get pulled down are not super small and they add up quickly. The last thing you want is to run out of storage on the nodes and wonder why it’s not working while all these processes are taking place in the background. Give your VMs a healthy amount of headroom for what is to come.</ul><h3 id="varstf"><span class="mr-2">vars.tf</span><a href="#varstf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div file="vars.tf" class="language-terraform highlighter-rouge"><div class="code-header"> <span data-label-text="vars.tf"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">variable</span> <span class="s2">"ssh_key"</span> <span class="p">{</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="s2">"&lt;your-ssh-key&gt;"</span>
<span class="p">}</span>

<span class="k">variable</span> <span class="s2">"proxmox_host"</span> <span class="p">{</span>
    <span class="nx">default</span> <span class="p">=</span> <span class="s2">"ProxMoxK8S"</span>
<span class="p">}</span>

<span class="k">variable</span> <span class="s2">"template_name"</span> <span class="p">{</span>
    <span class="nx">default</span> <span class="p">=</span> <span class="s2">"KubernetesNodeTemplate"</span>
<span class="p">}</span>

<span class="k">variable</span> <span class="s2">"vmid"</span> <span class="p">{</span>
      <span class="nx">type</span> <span class="p">=</span> <span class="nx">number</span>
      <span class="nx">default</span> <span class="p">=</span> <span class="mi">100</span>
    <span class="p">}</span>
</pre></table></code></div></div><h1 id="set-up-update-upgrade-install-docker">Set-up Update Upgrade Install Docker</h1><p>Log onto the server via SSH, update and upgrade, and finally install docker. For rancher, a specific version of docker seems to be needed. Use the following script to install docker:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl https://releases.rancher.com/install-docker/20.10.sh | sh
</pre></table></code></div></div><h1 id="set-up-rancher-k3s">Set up Rancher K3s</h1><p>Time to set up your Rancher K3s cluster. This “cluster” (it really isn’t) is the management cluster for your kubernetes cluster. The setup process is easy.</p><p>Run the following command on your GUI node:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>docker run <span class="nt">--privileged</span> <span class="nt">-d</span> <span class="nt">--restart</span><span class="o">=</span>unless-stopped <span class="nt">-p</span> 80:80 <span class="nt">-p</span> 443:443 rancher/rancher
</pre></table></code></div></div><p>This command will start rancher in a docker container on your GUI node.</p><p>After the docker container is up, you can hit the internal IP of the GUI node at <code class="language-plaintext highlighter-rouge">https://&lt;INTERNAL_IP&gt;:443</code></p><p>You will be welcomed by a screen asking you to create a password. run the command show and create an admin password.</p><p><img data-src="/project-assets/DeployingKubernetesWithRancher/get-bootstrap-password.png" alt="Get Boostrap Password" data-proofer-ignore></p><p><img data-src="/project-assets/DeployingKubernetesWithRancher/bootstrap-password-in-logs.png" alt="Bootstrap Password in Logs" data-proofer-ignore></p><p><img data-src="/project-assets/DeployingKubernetesWithRancher/set-admin-password.png" alt="Set Admin Password" data-proofer-ignore></p><p>After you have signed in, you will be greeted by the Rancher Dashboard.</p><h1 id="create-your-kubernetes-cluster">Create your Kubernetes Cluster</h1><p>Now it’s time to create your cluster.</p><p><img data-src="/project-assets/DeployingKubernetesWithRancher/click-create.png" alt="Click Create" data-proofer-ignore></p><p>Click the “Create button.</p><p><img data-src="/project-assets/DeployingKubernetesWithRancher/click-custom.png" alt="Click Custom" data-proofer-ignore></p><p>Click the “Custom” option.</p><p><img data-src="/project-assets/DeployingKubernetesWithRancher/name-cluster.png" alt="Name Cluster" data-proofer-ignore></p><p>Name your cluster</p><p><img data-src="/project-assets/DeployingKubernetesWithRancher/advanced-cluster-options.png" alt="Advanced Cluster Options" data-proofer-ignore></p><p>Keep everything default except for the <code class="language-plaintext highlighter-rouge">Nginx Ingress</code> option under advanced options. Set this to <code class="language-plaintext highlighter-rouge">Disabled</code>. We are going to install traefik later.</p><p>Click “Next”.</p><h1 id="join-your-master-and-worker-nodes-to-the-cluster">Join your master and worker nodes to the cluster</h1><p>Now it’s time to add your master and worker nodes to your new cluster.</p><p><img data-src="/project-assets/DeployingKubernetesWithRancher/master-node-options.png" alt="Master Node Options" data-proofer-ignore></p><p>To register your master node, make sure these boxes are checked (etcd, Control Plane). Click on the command to copy to your clipboard and paste it into the terminal with your SSH session to the master node. (You can use your master node as a worker node as well. I would not recommend this.</p><p><img data-src="/project-assets/DeployingKubernetesWithRancher/worker-node-options.png" alt="Worker Node Options" data-proofer-ignore></p><p>To register your master node, make sure this box is checked (Worker). Click on the command to copy to your clipboard and paste it into the terminal with your SSH session to the worker node.</p><h3 id="complete"><span class="mr-2">Complete</span><a href="#complete" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/containers/'>Containers</a>, <a href='/categories/kubernetes/'>Kubernetes</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/rancher/" class="post-tag no-text-decoration" >rancher</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Deploying+Kubernetes+With+Rancher+and+Proxmox+-+OchoaProjects&url=https%3A%2F%2Fochoaprojects.github.io%2Fposts%2FDeployingKubernetesWithRancher%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Deploying+Kubernetes+With+Rancher+and+Proxmox+-+OchoaProjects&u=https%3A%2F%2Fochoaprojects.github.io%2Fposts%2FDeployingKubernetesWithRancher%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fochoaprojects.github.io%2Fposts%2FDeployingKubernetesWithRancher%2F&text=Deploying+Kubernetes+With+Rancher+and+Proxmox+-+OchoaProjects" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/ProxMoxSetupInstall/">ProxMox Setup and Installation</a><li><a href="/posts/AboutMeAndTopology/">About Me and Homelab Topology</a><li><a href="/posts/PlexAutomation/">Plex Automation</a><li><a href="/posts/ProxMoxCloudInitImage/">Create a Debian Cloud-Init Template on Proxmox</a><li><a href="/posts/ProvisionDockerWithAnsible/">Provision a Linux Server With Docker Using Ansible</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/proxmox/">proxmox</a> <a class="post-tag" href="/tags/terraform/">terraform</a> <a class="post-tag" href="/tags/cloudinit/">cloudinit</a> <a class="post-tag" href="/tags/containers/">containers</a> <a class="post-tag" href="/tags/ec2/">ec2</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/DeployingKubernetesWithK3S/"><div class="card-body"> <em class="small" data-ts="1677603600" data-df="ll" > Feb 28, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Deploying Kubernetes With K3S and Proxmox</h3><div class="text-muted small"><p> Kubernetes (k8s) is the most popular and powerful container-orchestration platform. It lets you rapidly deploy, manage, and maintain applications. K3S is the lightweight and certified Kubernetes di...</p></div></div></a></div><div class="card"> <a href="/posts/PortainerDocumented/"><div class="card-body"> <em class="small" data-ts="1654621200" data-df="ll" > Jun 7, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Portainer Documented</h3><div class="text-muted small"><p> Portainer is a simple and lightweight, but powerful application that is used to provide a web management interface that you can use to perform functions on your Docker host. Table of Contents U...</p></div></div></a></div><div class="card"> <a href="/posts/FlaskAppWithSimpleSearch/"><div class="card-body"> <em class="small" data-ts="1671555600" data-df="ll" > Dec 20, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building a Search Feature in a Python Flask App</h3><div class="text-muted small"><p> Going through the steps on how to build a search feature in a Python Flask app. Flask is a popular microweb framework that makes it easy to build web applications in Python. We will use Jinja2 temp...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/FlaskAppWithSimpleSearch/" class="btn btn-outline-primary" prompt="Older"><p>Building a Search Feature in a Python Flask App</p></a> <a href="/posts/DeployingKubernetesWithK3S/" class="btn btn-outline-primary" prompt="Newer"><p>Deploying Kubernetes With K3S and Proxmox</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/ochoaprojects">Brandon Ochoa</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> hosted on Github</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/proxmox/">proxmox</a> <a class="post-tag" href="/tags/terraform/">terraform</a> <a class="post-tag" href="/tags/cloudinit/">cloudinit</a> <a class="post-tag" href="/tags/containers/">containers</a> <a class="post-tag" href="/tags/ec2/">ec2</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
